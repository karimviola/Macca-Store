<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø¯Ø§Ø© ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø¬Ø±Ø§Ø¨Ø§Øª - Macca Store</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #fff3e0; direction: rtl; }
    h1 { color: #e65100; display: flex; align-items: center; gap: 10px; }
    input, button { padding: 8px; width: 100%; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
    th { background-color: #e65100; color: white; }
    .form-section { background: #fff8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .logo { height: 50px; }
    .exists { color: green; font-weight: bold; }
    .update-button { background-color: #e65100; color: white; font-weight: bold; cursor: pointer; }
    .update-button:hover { background-color: #ff6f00; }
  </style>
</head>
<body>
  <h1>
    <img src="https://raw.githubusercontent.com/karimviola/index/main/macca-logo-orange.png" class="logo">
    Ø£Ø¯Ø§Ø© ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø¬Ø±Ø§Ø¨Ø§Øª - Macca Store
  </h1>

  <div class="form-section">
    <label>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</label>
    <input type="text" id="modelInput" placeholder="Ù…Ø«Ø§Ù„: iPhone 11 Ø£Ùˆ Oppo A76">
    <button class="update-button" onclick="fetchFromGitHub()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub</button>
    <button class="update-button" onclick="location.reload()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
  </div>

  <div class="form-section">
    <h3>â• Ø¥Ø¶Ø§ÙØ© ØªÙˆÙÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</h3>
    <input id="addModel1" placeholder="Ù…ÙˆØ¯ÙŠÙ„ 1">
    <input id="addModel2" placeholder="Ù…ÙˆØ¯ÙŠÙ„ 2">
    <input id="addPercent" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ§ÙÙ‚">
    <input id="addNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">
    <button onclick="addEntry()">â• Ø£Ø¶Ù</button>
    <button onclick="downloadJSON()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ JSON</button>
    <input type="file" id="uploadJSON" accept=".json" onchange="uploadJSON()">
  </div>

  <table>
    <thead>
      <tr><th>Ù…ÙˆØ¯ÙŠÙ„ 1</th><th>Ù…ÙˆØ¯ÙŠÙ„ 2</th><th>Ù†Ø³Ø¨Ø©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th>Ù…ØªÙˆÙØ±</th></tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>

<script>
  let data = [];

  function saveLocal() {
    localStorage.setItem("maccaData", JSON.stringify(data));
  }

  function loadLocal() {
    const saved = localStorage.getItem("maccaData");
    if (saved) data = JSON.parse(saved);
  }

  function fetchFromGitHub() {
    fetch("https://raw.githubusercontent.com/karimviola/index/main/Grab.Macca.Store")
      .then(r => r.json())
      .then(remote => {
        data = remote;
        saveLocal();
        render();
      }).catch(err => alert("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub"));
  }

  function render() {
    const body = document.getElementById("resultsBody");
    body.innerHTML = data.length ? "" : "<tr><td colspan='5'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>";
    data.forEach(d => {
      body.innerHTML += `<tr>
        <td>${d.m1}</td><td>${d.m2}</td><td>${d.percent}</td><td>${d.note}</td>
        <td class="exists">âœ”</td>
      </tr>`;
    });
  }

  function addEntry() {
    const m1 = document.getElementById("addModel1").value.trim();
    const m2 = document.getElementById("addModel2").value.trim();
    const percent = document.getElementById("addPercent").value.trim();
    const note = document.getElementById("addNote").value.trim();
    if (!m1 || !m2 || !percent) return alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    data.push({ m1, m2, percent, note });
    data.push({ m1: m2, m2: m1, percent, note });
    saveLocal();
    render();
    uploadToGitHub();
  }

  function downloadJSON() {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "Grab.Macca.Store";
    a.click();
    URL.revokeObjectURL(url);
  }

  function uploadJSON() {
    const file = document.getElementById("uploadJSON").files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const imported = JSON.parse(reader.result);
        if (Array.isArray(imported)) {
          data = imported;
          saveLocal();
          render();
          uploadToGitHub();
        } else {
          alert("ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
        }
      } catch { alert("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù"); }
    };
    reader.readAsText(file);
  }

  
function uploadToGitHub() {
  const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
  fetch('https://api.github.com/repos/karimviola/index/contents/Grab.Macca.Store', {
    method: 'PUT',
    headers: {
      'Authorization': 'Bearer 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',
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: 'ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø£Ø¯Ø§Ø© Macca Store',
      content: content,
      sha: null
    })
  })
  .then(res => res.json())
  .then(res => {
    if (res.commit) {
      alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ GitHub Ø¨Ù†Ø¬Ø§Ø­');
    } else {
      console.error(res);
      alert('âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« GitHub');
    }
  })
  .catch(err => {
    console.error(err);
    alert('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub');
  });
}


  document.getElementById("modelInput").addEventListener("input", e => {
    const val = e.target.value.toLowerCase();
    const filtered = data.filter(d => d.m1.toLowerCase().includes(val) || d.m2.toLowerCase().includes(val));
    const body = document.getElementById("resultsBody");
    body.innerHTML = filtered.map(d => `<tr>
      <td>${d.m1}</td><td>${d.m2}</td><td>${d.percent}</td><td>${d.note}</td>
      <td class="exists">âœ”</td>
    </tr>`).join('');
  });

  loadLocal();
  render();
</script>
</body>
</html>
